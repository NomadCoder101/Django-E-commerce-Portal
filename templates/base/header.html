{% load static i18n %}

<header class="bg-white shadow-sm" x-data="{ mobileMenuOpen: false }">
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8" aria-label="Top">
    <div
      class="w-full py-6 flex items-center justify-between border-b border-primary-500 lg:border-none"
    >
      <div class="flex items-center">
        <a href="{% url 'catalog:home' %}">
          <span class="sr-only">{{ site_name }}</span>
          <img class="h-10 w-auto" src="{% static 'img/logo.svg' %}" alt="" />
        </a>
        <div class="hidden ml-10 space-x-8 lg:block">
          <a
            href="{% url 'catalog:products' %}"
            class="text-base font-medium text-gray-900 hover:text-primary-600"
          >
            {% translate "Shop" %}
          </a>
          <a
            href="{% url 'catalog:categories' %}"
            class="text-base font-medium text-gray-900 hover:text-primary-600"
          >
            {% translate "Categories" %}
          </a>
          {% comment %}
          <!-- Blog section is not implemented yet -->
          <a
            href="{% url 'blog:post_list' %}"
            class="text-base font-medium text-gray-900 hover:text-primary-600"
          >
            {% translate "Blog" %}
          </a>
          {% endcomment %}
        </div>
      </div>
      <div class="ml-10 space-x-4 flex items-center">
        <div class="flex-1 flex items-center justify-end">
          <!-- Search -->
          <button
            @click="$store.searchModal.open()"
            class="p-2 text-gray-400 hover:text-gray-500"
          >
            <span class="sr-only">{% translate "Search" %}</span>
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </button>

          <!-- Currency Selector -->
          <div class="ml-4" x-data="{ open: false }">
            <button
              @click="open = !open"
              class="flex items-center text-gray-700 hover:text-gray-900"
            >
              <span>{{ active_currency }}</span>
              <svg
                class="ml-1 w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>
            <div
              x-show="open"
              @click.away="open = false"
              class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5"
            >
              {% for currency in available_currencies %}
              <a
                href="{% url 'set_currency' currency.code %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              >
                {{ currency.name }} ({{ currency.code }})
              </a>
              {% endfor %}
            </div>
          </div>

          <!-- Language Selector -->
          <div class="ml-4" x-data="{ open: false }">
            <button
              @click="open = !open"
              class="flex items-center text-gray-700 hover:text-gray-900"
            >
              <span>{{ LANGUAGE_CODE|upper }}</span>
              <svg
                class="ml-1 w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>
            <div
              x-show="open"
              @click.away="open = false"
              class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5"
            >
              {% load custom_i18n %} {% get_available_languages as languages %}
              {% for lang_code, lang_name in languages %}
              <a
                href="{% change_lang_url lang_code %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                hx-get="{% change_lang_url lang_code %}"
                hx-push-url="true"
              >
                {{ lang_name }}
              </a>
              {% endfor %}
            </div>
          </div>

          <!-- Cart -->
          <div class="ml-4 flow-root">
            <button
              @click="$store.cartDrawer.toggle()"
              class="group -m-2 p-2 flex items-center"
            >
              <svg
                class="flex-shrink-0 h-6 w-6 text-gray-400 group-hover:text-gray-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
                />
              </svg>
              <span
                class="ml-2 text-sm font-medium text-gray-700 group-hover:text-gray-800"
                >{{ cart.total_quantity|default:0 }}</span
              >
            </button>
          </div>

          <!-- Account -->
          {% if user.is_authenticated %}
          <div class="ml-4" x-data="{ open: false }">
            <button
              @click="open = !open"
              class="flex items-center text-gray-700 hover:text-gray-900"
            >
              <img
                class="h-8 w-8 rounded-full"
                src="{{ user.profile.avatar_url|default:'/static/img/default-avatar.png' }}"
                alt=""
              />
              <svg
                class="ml-1 w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>
            <div
              x-show="open"
              @click.away="open = false"
              class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5"
            >
              <a
                href="{% url 'customers:dashboard' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              >
                {% translate "Dashboard" %}
              </a>
              <a
                href="{% url 'customers:orders' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              >
                {% translate "Orders" %}
              </a>
              <a
                href="{% url 'customers:profile' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              >
                {% translate "Settings" %}
              </a>
              <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button
                  type="submit"
                  class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  {% translate "Sign out" %}
                </button>
              </form>
            </div>
          </div>
          {% else %}
          <div class="ml-4 flex space-x-4">
            <a
              href="{% url 'login' %}"
              class="text-base font-medium text-gray-900 hover:text-primary-600"
            >
              {% translate "Sign in" %}
            </a>
            <a href="{% url 'customers:register' %}" class="btn">
              {% translate "Sign up" %}
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="py-4 flex flex-wrap justify-center space-x-6 lg:hidden">
      <a
        href="{% url 'catalog:products' %}"
        class="text-base font-medium text-gray-900 hover:text-primary-600"
      >
        {% translate "Shop" %}
      </a>
      <a
        href="{% url 'catalog:categories' %}"
        class="text-base font-medium text-gray-900 hover:text-primary-600"
      >
        {% translate "Categories" %}
      </a>
      {% comment %}
      <!-- Blog functionality will be implemented later -->

      {% endcomment %}
    </div>
  </nav>
</header>
